<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Adding meta -->

        <!-- Adding external script-->

        <!-- Adding external style-->

        <!-- Adding scripts-->

        <!-- Adding style-->

        <!-- Adding overlay script-->

        <!-- Adding overlay style-->

        <title>Home</title>

        <!--[if lt IE 9]>
            <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css" />
        <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css" />
        <link type="text/css" rel="stylesheet" href="styles/reset.css" />
        <link type="text/css" rel="stylesheet" href="styles/heading.css" />
        <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css" />
        <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css" />

        <svg
            aria-hidden="true"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            style="display: none"
        >
            <defs>
                <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
                    <g>
                        <path
                            d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"
                        />
                        <path
                            d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"
                        />
                    </g>
                </symbol>
                <symbol id="search-icon" viewBox="0 0 512 512">
                    <g>
                        <g>
                            <path
                                d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"
                            />
                        </g>
                    </g>
                    <g>
                        <g>
                            <path
                                d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"
                            />
                        </g>
                    </g>
                </symbol>
                <symbol id="down-icon" viewBox="0 0 16 16">
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
                    ></path>
                </symbol>
            </defs>
        </svg>
    </head>

    <body>
        <nav class="navbar" id="navbar">
            <div class="navbar-heading" id="navbar-heading">
                <a href="index.html"><h2 class="navbar-heading-text">Home</h2></a>
            </div>
            <div class="search-box" id="search-box">
                <div class="search-box-input-container">
                    <input
                        class="search-box-input"
                        type="text"
                        placeholder="Search..."
                        id="search-box-input"
                    /><svg class="search-icon" alt="search-icon">
                        <use xlink:href="#search-icon"></use>
                    </svg>
                </div>
                <div class="search-item-container" id="search-item-container">
                    <ul class="search-item-ul" id="search-item-ul"></ul>
                </div>
            </div>
            <div class="sidebar-main-content" id="sidebar-main-content">
                <div class="accordion collapsed" id="7679992">
                    <h3 class="accordion-heading">
                        Classes<svg><use xlink:href="#down-icon"></use></svg>
                    </h3>
                    <ul class="accordion-content">
                        <li class="accordion collapsed child" id="3047382">
                            <div class="accordion-heading child">
                                <a href="WsClient.html">WsClient</a
                                ><svg><use xlink:href="#down-icon"></use></svg>
                            </div>
                            <ul class="methods accordion-content">
                                <li data-type="method">
                                    <a href="WsClient.html#connect">connect</a>
                                </li>
                                <li data-type="method">
                                    <a href="WsClient.html#getTotMessages">getTotMessages</a>
                                </li>
                                <li data-type="method">
                                    <a href="WsClient.html#onConnectionFailure"
                                        >onConnectionFailure</a
                                    >
                                </li>
                                <li data-type="method">
                                    <a href="WsClient.html#onConnectionReestablished"
                                        >onConnectionReestablished</a
                                    >
                                </li>
                                <li data-type="method">
                                    <a href="WsClient.html#onMessage">onMessage</a>
                                </li>
                                <li data-type="method"><a href="WsClient.html#send">send</a></li>
                                <li data-type="method">
                                    <a href="WsClient.html#setAuthenticationToken"
                                        >setAuthenticationToken</a
                                    >
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="accordion collapsed" id="6175723">
                    <h3 class="accordion-heading">
                        Modules<svg><use xlink:href="#down-icon"></use></svg>
                    </h3>
                    <ul class="accordion-content">
                        <li class="accordion collapsed child" id="1096515">
                            <div class="accordion-heading child">
                                <a href="module-Server.html">Server</a
                                ><svg><use xlink:href="#down-icon"></use></svg>
                            </div>
                            <ul class="methods accordion-content">
                                <li data-type="method">
                                    <a href="module-Server.html#~addToGroup">addToGroup</a>
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~addUser">addUser</a>
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~checkAuthentication"
                                        >checkAuthentication</a
                                    >
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~deleteGroup">deleteGroup</a>
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~deleteUser">deleteUser</a>
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~init">init</a>
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~onClientClosed">onClientClosed</a>
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~onConnection">onConnection</a>
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~onMessage">onMessage</a>
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~sendMessageToGroup"
                                        >sendMessageToGroup</a
                                    >
                                </li>
                                <li data-type="method">
                                    <a href="module-Server.html#~sendMessageToUser"
                                        >sendMessageToUser</a
                                    >
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="accordion collapsed" id="7164937">
                    <h3 class="accordion-heading">
                        Global<svg><use xlink:href="#down-icon"></use></svg>
                    </h3>
                    <ul class="accordion-content">
                        <li class="accordion-list" id="">
                            <a href="global.html#checkAuthenticationCallback"
                                >checkAuthenticationCallback</a
                            >
                        </li>
                        <li class="accordion-list" id="">
                            <a href="global.html#onClientClosedCallback">onClientClosedCallback</a>
                        </li>
                        <li class="accordion-list" id="">
                            <a href="global.html#onConnectionCallback">onConnectionCallback</a>
                        </li>
                        <li class="accordion-list" id="">
                            <a href="global.html#onMessageCallbackClient"
                                >onMessageCallbackClient</a
                            >
                        </li>
                        <li class="accordion-list" id="">
                            <a href="global.html#onMessageCallbackServer"
                                >onMessageCallbackServer</a
                            >
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="navbar-ham" id="navbar-ham">
            <div>
                <div class="first"></div>
                <div class="second"></div>
                <div class="third"></div>
            </div>
        </div>

        <div id="main" class="main-content">
            <section class="readme">
                <article>
                    <h1>ws-redis</h1>
                    <p>
                        <a href="https://travis-ci.com/alessandro-caldonazzi/ws-redis"
                            ><img
                                src="https://travis-ci.com/alessandro-caldonazzi/ws-redis.svg?branch=master"
                                alt="Build Status"
                        /></a>
                        <a
                            href="https://www.codacy.com/gh/alessandro-caldonazzi/ws-redis/dashboard?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=alessandro-caldonazzi/ws-redis&amp;utm_campaign=Badge_Grade"
                            ><img
                                src="https://app.codacy.com/project/badge/Grade/7ac8961bfefb4a4fa6292f2519186317"
                                alt="Codacy Badge"
                        /></a>
                    </p>
                    <p>
                        Node.js module that simplifies websocket usage introducing channels, groups
                        and tracking users.
                    </p>
                    <p>
                        Also, it allows you to use redis as a publish - subscribe for websocket
                        message delivery.
                    </p>
                    <p>It is divided into a server library and a client library</p>
                    <h2>Complete Docs</h2>
                    <p>
                        In this readme you will find an introduction, you can read the specific
                        documentation <a href="https://ws-redis.netlify.app/">here</a>
                    </p>
                    <h2>Server Library</h2>
                    <h3>Installation</h3>
                    <pre class="prettyprint source lang-sh"><code>npm i ws-redis
</code></pre>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>const wsRedis = require(&quot;ws-redis&quot;);
const ws = require(&quot;ws&quot;);

wsRedis.init(new ws.Server({ port: 8080 }));
</code></pre>
                    <h3>
                        <a href="https://ws-redis.netlify.app/module-Server.html#~onConnection"
                            >onConnection</a
                        >
                    </h3>
                    <p>Sets the callback to be called when a user logs on</p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>wsRedis.onConnection((wsInstance, authenticationToken) => {
    //authenticationToken is a optional token set by client,
    //if present, it means that the user has already been authenticated, so there is no need to check the authenticationToken here.
});
</code></pre>
                    <h3>
                        <a
                            href="https://ws-redis.netlify.app/module-Server.html#~checkAuthentication"
                            >Handle authentication</a
                        >
                    </h3>
                    <p>
                        Sets a callback to validate the authenticationToken set by the client
                        (optional).
                    </p>
                    <p>
                        The callback you set must return true if the authenticationToken is valid,
                        and can be an async function.
                    </p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>wsRedis.checkAuthentication((authenticationToken) =>{
    if(/* authenticationToken is valid */){
        return true;
    }
    return false;
});
</code></pre>
                    <h3>
                        <a href="https://ws-redis.netlify.app/module-Server.html#~addToGroup"
                            >Identify users and groups</a
                        >
                    </h3>
                    <p>
                        You can identify a user with a string at any time, for example during
                        connection.
                    </p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>wsRedis.onConnection((wsInstance, authenticationToken) => {
    wsRedis.addUser(&quot;userName&quot;, wsInstance);
    //from now on you can refer to the user by his identifier
});
</code></pre>
                    <p>
                        You can also group users into groups, e.g. to send a broadcast message to
                        all of them.
                    </p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>wsRedis.onConnection((wsInstance, authenticationToken) => {
    wsRedis.addToGroup(&quot;groupName&quot;, wsInstance);
});
</code></pre>
                    <h3>
                        <a href="https://ws-redis.netlify.app/module-Server.html#~onMessage"
                            >Handle messages</a
                        >
                    </h3>
                    <p>
                        Messages are sent/received on channels, you have to manage messages coming
                        from different channels separately.
                    </p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>wsRedis.onMessage(&quot;channelName&quot;, (message, wsInstance, userIdentifier) => {
    console.log(message);
    //wsInstance can be used to add the user to a group for example

    //If you have added the user with the addUser() method, userIdentifier will show you the identifier of the user who sent the message
    console.log(userIdentifier); //identifier set in addUser()
});
</code></pre>
                    <h3>
                        <a href="https://ws-redis.netlify.app/module-Server.html#~sendMessageToUser"
                            >Send message to user</a
                        >
                    </h3>
                    <p>
                        To send a message you have to specify the user identifier (set in
                        addUser()), the channel and the message to be sent, you can also pass a JSON
                    </p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>wsRedis.sendMessageToUser(&quot;userName&quot;, &quot;channelName&quot;, &quot;data I want to send&quot;);
</code></pre>
                    <p>
                        If you have set up redis, in case the specified user is not on this node
                        server, it will be sent from the node instance that owns that user
                    </p>
                    <h3>
                        <a
                            href="https://ws-redis.netlify.app/module-Server.html#~sendMessageToGroup"
                            >Send message to group</a
                        >
                    </h3>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>wsRedis.sendMessageToGroup(&quot;groupName&quot;, &quot;channelName&quot;, &quot;data I want to send&quot;);
</code></pre>
                    <h3>
                        <a href="https://ws-redis.netlify.app/module-Server.html#~onClientClosed"
                            >Handle client closed connection</a
                        >
                    </h3>
                    <p>
                        When a client disconnects with the close() method or due to connection
                        problems, a callback (if set) is called on the server to notify you of the
                        incident
                    </p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>wsRedis.onClientClosed((userIdentifier, groups) => {
    //userIdentifier of the disconnected user
    //groups is a string Array, contains the identifier of the groups in which the user participated
});
</code></pre>
                    <h2><a href="https://ws-redis.netlify.app/WsClient.html">Client:</a></h2>
                    <p>
                        The client can be used either on node with the ws library or on a browser.
                        If you are on browser you can include it from cdn:
                    </p>
                    <pre class="prettyprint source lang-html"><code>&lt;script
    src=&quot;https://cdn.jsdelivr.net/gh/alessandro-caldonazzi/ws-redis/src/client/client.js&quot;
    defer
>&lt;/script>
</code></pre>
                    <h3>Initiate</h3>
                    <p>If you are on browser use WebSocket</p>
                    <pre class="prettyprint source lang-js"><code>const connection = new WsClient({
    url: &quot;ws://x.y:8080&quot;,
    websocket: WebSocket,
});
connection.connect();
</code></pre>
                    <p>If you are on nodejs use the ws library</p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>const WebSocket = require(&quot;ws&quot;);
const connection = new WsClient({
    url: &quot;ws://x.y:8080&quot;,
    websocket: WebSocket,
    authenticationToken: &quot;jwt for example&quot;, // this is optional, use this if you need authentication (remember to set the checkAuthentication callback on server)
});
connection.connect();
</code></pre>
                    <h3>
                        <a href="https://ws-redis.netlify.app/WsClient.html#connect">connect</a>
                    </h3>
                    <p>
                        To start the ws connection you need to call <code>connect()</code> Returns a
                        promise, if you need to wait for a successful connection with await
                    </p>
                    <pre class="prettyprint source lang-js"><code>connection.connect();
</code></pre>
                    <pre class="prettyprint source lang-js"><code>await connection.connect();
</code></pre>
                    <h3>
                        <a href="https://ws-redis.netlify.app/WsClient.html#onMessage"
                            >Handle message</a
                        >
                    </h3>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>connection.onMessage(&quot;channelName&quot;, (data) => {
    console.log(data);
});
</code></pre>
                    <h3>
                        <a href="https://ws-redis.netlify.app/WsClient.html#send"
                            >Send message to server</a
                        >
                    </h3>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>connection.send(&quot;channelName&quot;, &quot;your data&quot;);
</code></pre>
                    <p>Data can be JSON</p>
                    <h3>
                        <a href="https://ws-redis.netlify.app/WsClient.html#onConnectionFailure"
                            >onConnectionFailure</a
                        >
                    </h3>
                    <p>
                        Set a callback to be notified when connection fail (for example connection
                        instability)
                    </p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>connection.onConnectionFailure(() => {
    console.warn(&quot;connection lost&quot;);
});
</code></pre>
                    <h3>
                        <a
                            href="https://ws-redis.netlify.app/WsClient.html#onConnectionReestablished"
                            >onConnectionReestablished</a
                        >
                    </h3>
                    <p>Set a callback to be notified when the connection is re-established</p>
                    <pre
                        class="prettyprint source lang-js"
                    ><code>connection.onConnectionReestablished(() => {
    console.log(&quot;connection re-established&quot;);
});
</code></pre>
                </article>
            </section>
        </div>

        <footer class="footer" id="footer"></footer>

        <script src="scripts/third-party/prettify.js"></script>
        <script src="scripts/third-party/lang-css.js"></script>
        <script type="text/javascript" src="scripts/misc.js"></script>

        <script>
            prettyPrint();
        </script>
        <script src="scripts/linenumber.js"></script>
        <script src="scripts/fix-code-block.js"></script>
        <script src="scripts/fix-navbar.js"></script>

        <script src="scripts/search.js"></script>
        <script src="scripts/third-party/fuse.js"></script>
        <script>
            var list = [
                { title: "WsClient", link: '<a href="WsClient.html">WsClient</a>' },
                {
                    title: "WsClient#connect",
                    link: '<a href="WsClient.html#connect">WsClient &rtrif; connect</a>',
                },
                {
                    title: "WsClient#getTotMessages",
                    link: '<a href="WsClient.html#getTotMessages">WsClient &rtrif; getTotMessages</a>',
                },
                {
                    title: "WsClient#onConnectionFailure",
                    link: '<a href="WsClient.html#onConnectionFailure">WsClient &rtrif; onConnectionFailure</a>',
                },
                {
                    title: "WsClient#onConnectionReestablished",
                    link: '<a href="WsClient.html#onConnectionReestablished">WsClient &rtrif; onConnectionReestablished</a>',
                },
                {
                    title: "WsClient#onMessage",
                    link: '<a href="WsClient.html#onMessage">WsClient &rtrif; onMessage</a>',
                },
                {
                    title: "WsClient#send",
                    link: '<a href="WsClient.html#send">WsClient &rtrif; send</a>',
                },
                {
                    title: "WsClient#setAuthenticationToken",
                    link: '<a href="WsClient.html#setAuthenticationToken">WsClient &rtrif; setAuthenticationToken</a>',
                },
                { title: "Server", link: '<a href="module-Server.html">Server</a>' },
                {
                    title: "module:Server~addToGroup",
                    link: '<a href="module-Server.html#~addToGroup">module:Server~addToGroup &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~addUser",
                    link: '<a href="module-Server.html#~addUser">module:Server~addUser &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~checkAuthentication",
                    link: '<a href="module-Server.html#~checkAuthentication">module:Server~checkAuthentication &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~deleteGroup",
                    link: '<a href="module-Server.html#~deleteGroup">module:Server~deleteGroup &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~deleteUser",
                    link: '<a href="module-Server.html#~deleteUser">module:Server~deleteUser &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~init",
                    link: '<a href="module-Server.html#~init">module:Server~init &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~onClientClosed",
                    link: '<a href="module-Server.html#~onClientClosed">module:Server~onClientClosed &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~onConnection",
                    link: '<a href="module-Server.html#~onConnection">module:Server~onConnection &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~onMessage",
                    link: '<a href="module-Server.html#~onMessage">module:Server~onMessage &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~sendMessageToGroup",
                    link: '<a href="module-Server.html#~sendMessageToGroup">module:Server~sendMessageToGroup &rtrif; undefined</a>',
                },
                {
                    title: "module:Server~sendMessageToUser",
                    link: '<a href="module-Server.html#~sendMessageToUser">module:Server~sendMessageToUser &rtrif; undefined</a>',
                },
                {
                    title: "checkAuthenticationCallback",
                    link: '<a href="global.html#checkAuthenticationCallback">checkAuthenticationCallback</a>',
                },
                {
                    title: "onClientClosedCallback",
                    link: '<a href="global.html#onClientClosedCallback">onClientClosedCallback</a>',
                },
                {
                    title: "onConnectionCallback",
                    link: '<a href="global.html#onConnectionCallback">onConnectionCallback</a>',
                },
                {
                    title: "onMessageCallbackClient",
                    link: '<a href="global.html#onMessageCallbackClient">onMessageCallbackClient</a>',
                },
                {
                    title: "onMessageCallbackServer",
                    link: '<a href="global.html#onMessageCallbackServer">onMessageCallbackServer</a>',
                },
            ];
            var options = setupSearch(list, options);
        </script>
    </body>
</html>
